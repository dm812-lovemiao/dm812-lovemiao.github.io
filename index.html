<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç‰¹åˆ«çš„å¿ƒæ„</title>
  <!-- å¼•å…¥Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- å¼•å…¥Font Awesome -->
  <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            love: '#ec4899',
          },
        }
      }
    }
  </script>

  <style type="text/tailwindcss">
    @layer utilities {
      .text-shadow {
        text-shadow: 0 2px 10px rgba(236, 72, 153, 0.3);
      }
      .heart-beat {
        animation: heartBeat 1.5s infinite;
      }
      .wiggle {
        animation: wiggle 1s ease-in-out infinite;
      }
      .star-twinkle {
        animation: twinkle 2s infinite alternate;
      }
      .star-float {
        animation: float 8s infinite ease-in-out;
      }
    }

    /* æ ¸å¿ƒåŠ¨ç”»å®šä¹‰ */
    @keyframes heartBeat {
      0%, 100% { transform: scale(1); }
      14% { transform: scale(1.1); }
      28% { transform: scale(1); }
      42% { transform: scale(1.1); }
      70% { transform: scale(1); }
    }

    @keyframes wiggle {
      0%, 100% { transform: rotate(-3deg); }
      50% { transform: rotate(3deg); }
    }

    @keyframes twinkle {
      from { opacity: 0.5; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1.1); }
    }

    @keyframes float {
      0%, 100% { transform: translate(0, 0); }
      25% { transform: translate(10px, -10px); }
      50% { transform: translate(5px, 10px); }
      75% { transform: translate(-10px, 5px); }
    }

    /* æµæ˜Ÿç‰¹æ•ˆå¢å¼º */
    @keyframes starPulse {
      0%, 100% {
        opacity: 1;
        transform: scale(1.2);
        text-shadow: 0 0 15px rgba(59, 130, 246, 1);
      }
      50% {
        opacity: 0.8;
        transform: scale(1);
        text-shadow: 0 0 10px rgba(59, 130, 246, 0.8);
      }
    }

    .meteor {
      position: absolute;
      pointer-events: none;
      z-index: 1;
    }

    .meteor-trail {
      position: absolute;
      background: linear-gradient(to right,
          rgba(59, 130, 246, 0.8) 0%,
          rgba(147, 197, 253, 0.6) 20%,
          rgba(147, 197, 253, 0.4) 40%,
          rgba(147, 197, 253, 0.2) 60%,
          rgba(147, 197, 253, 0.1) 80%,
          rgba(147, 197, 253, 0) 100%);
      transform-origin: left center;
      box-shadow: 0 0 12px 2px rgba(59, 130, 246, 0.3);
    }

    .meteor-star {
      position: absolute;
      color: #3b82f6;
      z-index: 2;
      animation: starPulse 0.6s infinite;
    }

    /* èƒŒæ™¯æ¸å˜åŠ¨ç”» */
    body {
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* ä¿¡å°æ ·å¼ */
    .envelope-scene {
      perspective: 1000px;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .envelope-wrapper {
      position: relative;
      width: 80%;
      max-width: 280px;
      height: 200px;
      cursor: pointer;
    }

    .envelope {
      position: relative;
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
      transition: transform 0.8s cubic-bezier(0.645, 0.045, 0.355, 1);
    }

    .envelope-opened .envelope {
      transform: rotateX(180deg);
    }

    .envelope-front, .envelope-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      background-color: white;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }

    .envelope-front {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .envelope-back {
      transform: rotateX(180deg);
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      padding-top: 30px;
    }

    .envelope-flap {
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      height: 55%;
      background-color: white;
      border: 2px solid #e5e7eb;
      border-radius: 8px 8px 0 0;
      transform-origin: bottom;
      transition: transform 0.6s cubic-bezier(0.645, 0.045, 0.355, 1) 0.2s;
      z-index: 2;
    }

    .envelope-opened .envelope-flap {
      transform: rotateX(180deg);
    }

    .envelope-seal {
      position: absolute;
      width: 24px;
      height: 24px;
      color: #ec4899;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-shadow: 0 0 0 4px rgba(236, 72, 153, 0.2);
      z-index: 3;
      transition: all 0.5s ease-out;
      opacity: 1;
    }

    .envelope-opened .envelope-seal {
      opacity: 0;
      transform: translate(-50%, -50%) scale(0);
    }

    .envelope-text {
      color: #5a3d5c;
      font-weight: 600;
      font-size: 18px;
      text-align: center;
      line-height: 1.5;
      padding: 0 15px;
    }

    /* å¦ä¸€ç‰ˆå…¥å£æ ·å¼ */
    .another-version {
      position: fixed;
      bottom: 20px;
      right: 20px;
      color: rgba(255, 255, 255, 0.8);
      font-size: 14px;
      cursor: pointer;
      padding: 6px 10px;
      border-radius: 4px;
      transition: all 0.3s ease;
      background-color: rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(4px);
      z-index: 100;
      opacity: 0;
      pointer-events: none;
      transition: all 0.5s ease;
    }

    .another-version.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .another-version:hover {
      color: white;
      background-color: rgba(0, 0, 0, 0.3);
      transform: translateY(-2px);
    }
  </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-purple-900 via-pink-900 to-purple-900 flex items-center justify-center p-4 font-sans overflow-x-hidden relative">
  <!-- æ˜Ÿæ˜ŸèƒŒæ™¯ -->
  <div id="stars-container" class="fixed inset-0 pointer-events-none z-0"></div>

  <!-- æµæ˜Ÿå®¹å™¨ -->
  <div id="meteors-container" class="fixed inset-0 pointer-events-none z-0"></div>


  <div class="max-w-4xl w-full mx-auto relative z-10">
    <!-- åˆå§‹é—®é¢˜ç•Œé¢ - é»˜è®¤æ˜¾ç¤º -->
    <div id="stage1" class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-2xl p-8 text-center transition-all duration-500 transform border border-pink-100">
      <h1 class="text-[clamp(1.5rem,4vw,2.2rem)] font-bold text-gray-800 mb-6 text-shadow">æœ‰ä»¶å¾ˆé‡è¦çš„äº‹æƒ³å‘Šè¯‰ä½ ...</h1>
      <p class="text-[clamp(1.1rem,3vw,1.5rem)] text-gray-700 mb-10">æˆ‘å–œæ¬¢ä½ ï¼Œä½ æ„¿æ„åšæˆ‘çš„å¥³æœ‹å‹å—ï¼Ÿ</p>

      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <button id="stage1-yes" class="bg-love hover:bg-love/90 text-white font-bold py-3 px-8 rounded-full text-lg shadow-lg transform transition-all duration-300 hover:scale-105 heart-beat">
          æ„¿æ„ <i class="fa fa-heart ml-1"></i>
        </button>
        <button id="stage1-no" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-8 rounded-full text-lg shadow transition-all duration-300">
          ä¸æ„¿æ„ <i class="fa fa-times ml-1"></i>
        </button>
      </div>
    </div>

    <!-- ç¬¬äºŒé˜¶æ®µï¼šåŒ…å›´çš„æŒ‰é’® - é»˜è®¤éšè— -->
    <div id="stage2" class="hidden bg-white/80 backdrop-blur-sm rounded-2xl shadow-2xl p-8 text-center border border-pink-100">
      <h2 class="text-xl font-bold text-gray-800 mb-6 text-shadow">å†è®¤çœŸè€ƒè™‘ä¸€ä¸‹å˜›ï¼Ÿ</h2>
      <p class="text-gray-600 mb-8">æˆ‘çš„å¿ƒæ„æ˜¯è®¤çœŸçš„~</p>

      <div class="relative h-60 flex items-center justify-center mb-4">
        <button class="stage2-yes absolute bg-love hover:bg-love/90 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-all duration-300 hover:scale-105" style="top: 10%; left: 50%; transform: translateX(-50%);">
          æ„¿æ„ <i class="fa fa-heart ml-1"></i>
        </button>
        <button class="stage2-yes absolute bg-love hover:bg-love/90 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-all duration-300 hover:scale-105" style="bottom: 10%; left: 50%; transform: translateX(-50%);">
          å¥½å‘€ <i class="fa fa-smile-o ml-1"></i>
        </button>
        <button class="stage2-yes absolute bg-love hover:bg-love/90 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-all duration-300 hover:scale-105" style="top: 50%; left: 10%; transform: translateY(-50%);">
          å¯ä»¥ <i class="fa fa-thumbs-up ml-1"></i>
        </button>
        <button class="stage2-yes absolute bg-love hover:bg-love/90 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-all duration-300 hover:scale-105" style="top: 50%; right: 10%; transform: translateY(-50%);">
          æˆ‘æ„¿æ„ <i class="fa fa-heart ml-1"></i>
        </button>

        <button id="stage2-no" class="bg-gray-300 text-gray-800 font-bold py-3 px-8 rounded-full text-lg shadow transition-all duration-500 transform">
          ä¸æ„¿æ„ <i class="fa fa-times ml-1"></i>
        </button>
      </div>
    </div>

    <!-- æœ€ç»ˆé˜¶æ®µï¼šå¤šä¸ªæ„¿æ„æŒ‰é’® - é»˜è®¤éšè— -->
    <div id="final-stage" class="hidden flex flex-col items-center justify-center w-full h-full">
      <h2 class="text-2xl font-bold text-white mb-2 text-shadow">è¿™ä¸€å®šæ˜¯å‘½ä¸­æ³¨å®šï¼</h2>
      <p class="text-gray-200 mb-4">é€‰ä¸€ä¸ªæŒ‰é’®ï¼Œè®©æˆ‘çŸ¥é“ä½ çš„ç­”æ¡ˆå§~</p>
      <div id="button-container" class="flex flex-wrap justify-center gap-4">
        <button class="final-btn bg-love hover:bg-love/90 text-white font-bold py-2 px-4 rounded-full shadow-lg transition-all duration-300 hover:scale-110">æˆ‘æ„¿æ„ â¤ï¸</button>
        <button class="final-btn bg-love hover:bg-love/90 text-white font-bold py-2 px-4 rounded-full shadow-lg transition-all duration-300 hover:scale-110">æˆ‘æ„¿æ„ â¤ï¸</button>
        <button class="final-btn bg-love hover:bg-love/90 text-white font-bold py-2 px-4 rounded-full shadow-lg transition-all duration-300 hover:scale-110">æˆ‘çˆ±ä½  â¤ï¸</button>
        <button class="final-btn bg-love hover:bg-love/90 text-white font-bold py-2 px-4 rounded-full shadow-lg transition-all duration-300 hover:scale-110">å¥½å‘€ ğŸ˜Š</button>
        <button class="final-btn bg-love hover:bg-love/90 text-white font-bold py-2 px-4 rounded-full shadow-lg transition-all duration-300 hover:scale-110">å¥½å‘€ ğŸ˜Š</button>
        <button class="final-btn bg-love hover:bg-love/90 text-white font-bold py-2 px-4 rounded-full shadow-lg transition-all duration-300 hover:scale-110">æˆ‘æ„¿æ„</button>
        <button class="final-btn bg-love hover:bg-love/90 text-white font-bold py-2 px-4 rounded-full shadow-lg transition-all duration-300 hover:scale-110">å½“ç„¶å•¦ ğŸ‘</button>
        <button class="final-btn bg-love hover:bg-love/90 text-white font-bold py-2 px-4 rounded-full shadow-lg transition-all duration-300 hover:scale-110">å¥½å‘€ ğŸ˜Š</button>
        <button class="final-btn bg-love hover:bg-love/90 text-white font-bold py-2 px-4 rounded-full shadow-lg transition-all duration-300 hover:scale-110">æˆ‘çˆ±ä½  â¤ï¸</button>
        <button class="final-btn bg-love hover:bg-love/90 text-white font-bold py-2 px-4 rounded-full shadow-lg transition-all duration-300 hover:scale-110">å¥½å‘€ ğŸ˜Š</button>
        <button class="final-btn bg-love hover:bg-love/90 text-white font-bold py-2 px-4 rounded-full shadow-lg transition-all duration-300 hover:scale-110">å½“ç„¶å•¦ ğŸ‘</button>
        <button class="final-btn bg-love hover:bg-love/90 text-white font-bold py-2 px-4 rounded-full shadow-lg transition-all duration-300 hover:scale-110">å½“ç„¶å•¦ ğŸ‘</button>
        <button class="final-btn bg-love hover:bg-love/90 text-white font-bold py-2 px-4 rounded-full shadow-lg transition-all duration-300 hover:scale-110">æˆ‘æ„¿æ„ â¤ï¸</button>
        <button class="final-btn bg-love hover:bg-love/90 text-white font-bold py-2 px-4 rounded-full shadow-lg transition-all duration-300 hover:scale-110">æˆ‘ä¹Ÿæ˜¯</button>
        <button class="final-btn bg-love hover:bg-love/90 text-white font-bold py-2 px-4 rounded-full shadow-lg transition-all duration-300 hover:scale-110">å½“ç„¶å•¦ ğŸ‘</button>
      </div>
    </div>

    <!-- ä¿¡å°å¼¹çª— - é»˜è®¤éšè— -->
    <div id="envelope-popup" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex flex-col items-center justify-center p-4">
      <h3 class="text-2xl font-bold text-white mb-8 text-shadow text-center px-4">æˆ‘æœ‰ä¸€ä»½ç‰¹åˆ«çš„ä¿¡è¦ç»™ä½ </h3>
      <div class="envelope-scene">
        <div class="envelope-wrapper" id="envelope-wrapper">
          <div class="envelope-flap"></div>
          <div class="envelope-seal">
            <i class="fa fa-heart text-2xl"></i>
          </div>
          <div class="envelope">
            <div class="envelope-front">
              <i class="fa fa-envelope text-4xl text-love mb-2"></i>
              <p class="text-gray-700 font-medium">ç‚¹å‡»å¼€å¯</p>
            </div>
            <div class="envelope-back">
              <p class="envelope-text">äº²çˆ±çš„ï¼Œ<br>ä»é‡è§ä½ çš„é‚£ä¸€åˆ»èµ·ï¼Œ<br>æˆ‘å°±çŸ¥é“ä½ æ˜¯æˆ‘è¦æ‰¾çš„äººã€‚<br>å¾€åä½™ç”Ÿï¼Œè¯·å¤šæŒ‡æ•™ã€‚</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- è·³è½¬æç¤º - é»˜è®¤éšè— -->
    <div id="redirect-message" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div class="bg-white rounded-2xl p-8 max-w-md w-full text-center transform transition-all scale-100 shadow-2xl border border-pink-100">
        <div class="text-6xl text-love mb-4 heart-beat">
          <i class="fa fa-heart"></i>
        </div>
        <h2 class="text-2xl font-bold text-gray-800 mb-4">å›å¿†ä¹‹æ—…å³å°†å¼€å§‹</h2>
        <p class="text-gray-600 mb-6">è®©æˆ‘ä»¬ä¸€èµ·åˆ›é€ æ›´å¤šç¾å¥½æ—¶å…‰</p>
        <button id="redirect-btn" class="bg-love hover:bg-love/90 text-white font-bold py-3 px-8 rounded-full text-lg transition-all duration-300 hover:scale-105">
          å¼€å§‹ <i class="fa fa-arrow-right ml-1"></i>
        </button>
      </div>
    </div>
  </div>

  <script>
    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      createStars();
      startMeteorShower();
      bindEvents();
    });

    // åˆ›å»ºæ˜Ÿç©ºèƒŒæ™¯ï¼ˆå¢å¼ºç‰ˆï¼‰
    function createStars() {
      const container = document.getElementById('stars-container');
      const starCount = 200; // å¢åŠ æ˜Ÿæ˜Ÿæ•°é‡

      for (let i = 0; i < starCount; i++) {
        const star = document.createElement('div');
        star.innerHTML = '<i class="fa fa-star"></i>';

        // éšæœºæ˜Ÿæ˜Ÿå±æ€§
        const size = 2 + Math.floor(Math.random() * 10);
        const opacity = 0.3 + Math.random() * 0.7;
        const isBlue = Math.random() > 0.7;
        const delay = Math.random() * 5; // éšæœºåŠ¨ç”»å»¶è¿Ÿ
        const floatDuration = 5 + Math.random() * 15; // éšæœºæ¼‚æµ®æ—¶é—´

        star.className = 'absolute star-twinkle star-float';
        star.style.color = isBlue ? '#93c5fd' : '#ffffff';
        star.style.fontSize = `${size}px`;
        star.style.opacity = opacity;
        star.style.animationDelay = `${delay}s`;
        star.style.animationDuration = `${floatDuration}s`;

        // éšæœºä½ç½®
        const x = Math.random() * 100;
        const y = Math.random() * 100;
        star.style.left = `${x}%`;
        star.style.top = `${y}%`;

        container.appendChild(star);
      }
    }

    // åˆ›å»ºæµæ˜Ÿï¼ˆå¢å¼ºç‰ˆï¼‰
    function createMeteor() {
      const container = document.getElementById('meteors-container');
      if (!container) return;

      const meteor = document.createElement('div');
      meteor.className = 'meteor';

      // éšæœºæµæ˜Ÿå‚æ•°
      const angle = 15 + Math.random() * 45; // 15-60åº¦çš„é£è¡Œè§’åº¦
      const speed = 1.5 + Math.random() * 2; // æ›´å¿«çš„æµæ˜Ÿé€Ÿåº¦
      const trailLength = 100 + Math.random() * 300; // æ›´é•¿çš„æ‹–å°¾
      const starSize = 14 + Math.random() * 8; // æ›´å¤§çš„æµæ˜Ÿå¤´éƒ¨
      const isPink = Math.random() > 0.7; // å¢åŠ ç²‰è‰²æµæ˜Ÿ

      // åˆ›å»ºæ‹–å°¾
      const trail = document.createElement('div');
      trail.className = 'meteor-trail';
      trail.style.width = '2px';
      trail.style.height = `${trailLength}px`;
      trail.style.transform = `rotate(${angle}deg)`;

      // ç²‰è‰²æµæ˜Ÿç‰¹æ®Šæ ·å¼
      if (isPink) {
        trail.style.background = 'linear-gradient(to right, rgba(236, 72, 153, 0.8) 0%, rgba(249, 115, 22, 0.6) 20%, rgba(249, 115, 22, 0.4) 40%, rgba(249, 115, 22, 0.2) 60%, rgba(249, 115, 22, 0.1) 80%, rgba(249, 115, 22, 0) 100%)';
        trail.style.boxShadow = '0 0 12px 2px rgba(236, 72, 153, 0.3)';
      }

      // åˆ›å»ºæ˜Ÿæ˜Ÿï¼ˆæµæ˜Ÿå¤´éƒ¨ï¼‰
      const star = document.createElement('div');
      star.className = 'meteor-star';
      star.innerHTML = '<i class="fa fa-star"></i>';
      star.style.fontSize = `${starSize}px`;
      star.style.left = '0px';
      star.style.top = '0px';
      if (isPink) {
        star.style.color = '#ec4899';
      }

      // ç»„åˆæµæ˜Ÿå…ƒç´ 
      meteor.appendChild(trail);
      meteor.appendChild(star);

      // éšæœºèµ·å§‹ä½ç½®ï¼ˆå¯èƒ½ä»å·¦ã€ä¸Šæˆ–å³ä¸Šï¼‰
      const startPositions = [
        {x: -200 - Math.random() * 300, y: -100 + Math.random() * 200}, // å·¦ä¸Š
        {x: window.innerWidth + 200, y: -100 + Math.random() * 200}, // å³ä¸Š
        {x: -200 + Math.random() * window.innerWidth, y: -200} // é¡¶éƒ¨
      ];
      const startPos = startPositions[Math.floor(Math.random() * startPositions.length)];
      meteor.style.left = `${startPos.x}px`;
      meteor.style.top = `${startPos.y}px`;

      // è®¡ç®—é£è¡Œè§’åº¦å’Œè·ç¦»
      const radians = angle * (Math.PI / 180);
      const distanceX = Math.cos(radians) * (window.innerWidth + 800);
      const distanceY = Math.sin(radians) * (window.innerHeight + 800);

      // åº”ç”¨åŠ¨ç”»
      meteor.style.transition = `transform ${speed}s cubic-bezier(0.2, 0.1, 0.3, 1) forwards`;
      setTimeout(() => {
        meteor.style.transform = `translate(${distanceX}px, ${distanceY}px)`;
      }, 10);

      // æ·»åŠ åˆ°å®¹å™¨
      container.appendChild(meteor);

      // åŠ¨ç”»ç»“æŸåç§»é™¤
      setTimeout(() => {
        if (meteor && meteor.parentNode) {
          meteor.parentNode.removeChild(meteor);
        }
      }, speed * 1000);
    }

    // æµæ˜Ÿé›¨ï¼ˆå¢å¼ºç‰ˆï¼‰
    function startMeteorShower() {
      // åˆå§‹ç”Ÿæˆæ›´å¤šæµæ˜Ÿ
      for (let i = 0; i < 5; i++) {
        setTimeout(createMeteor, i * 1000);
      }

      // æ›´é¢‘ç¹åœ°ç”Ÿæˆæµæ˜Ÿ
      setInterval(() => {
        const randomDelay = Math.random() * 2000 + 500;
        setTimeout(createMeteor, randomDelay);
      }, 1500);
    }

    // ç»‘å®šäº¤äº’äº‹ä»¶ï¼ˆä¿æŒåŸæœ‰é€»è¾‘ï¼‰
    function bindEvents() {
      let stage1Attempts = 0;
      const MAX_STAGE1_ATTEMPTS = 5;

      let stage2Attempts = 0;
      const MAX_STAGE2_ATTEMPTS = 5;

      const targetUrl = "start.html";
      const anotherVersionUrl = "baobao.html";

      // è·å–DOMå…ƒç´ 
      const stage1 = document.getElementById('stage1');
      const stage2 = document.getElementById('stage2');
      const finalStage = document.getElementById('final-stage');
      const envelopePopup = document.getElementById('envelope-popup');
      const envelopeWrapper = document.getElementById('envelope-wrapper');
      const redirectMessage = document.getElementById('redirect-message');
      const redirectBtn = document.getElementById('redirect-btn');
      const anotherVersion = document.getElementById('another-version');

      // æ˜¾ç¤ºä¿¡å°å¼¹çª—
      function showEnvelope() {
        // éšè—æ‰€æœ‰é˜¶æ®µ
        document.querySelectorAll('div[id^="stage"]').forEach(stage => {
          stage.classList.add('hidden');
        });
        envelopePopup.classList.remove('hidden');
      }

      // ç¬¬ä¸€é˜¶æ®µï¼šåˆå§‹è¡¨ç™½
      const stage1Yes = document.getElementById('stage1-yes');
      const stage1No = document.getElementById('stage1-no');

      // ç‚¹å‡»"æ„¿æ„"ç›´æ¥æ˜¾ç¤ºä¿¡å°
      stage1Yes.addEventListener('click', showEnvelope);

      // "ä¸æ„¿æ„"æŒ‰é’®èº²é¿é€»è¾‘
      stage1No.addEventListener('mouseover', () => {
        stage1Attempts++;

        // è¾¾åˆ°æœ€å¤§å°è¯•æ¬¡æ•°ï¼Œè¿›å…¥ç¬¬äºŒé˜¶æ®µ
        if (stage1Attempts >= MAX_STAGE1_ATTEMPTS) {
          stage1.classList.add('opacity-0', 'scale-95');
          setTimeout(() => {
            stage1.classList.add('hidden');
            stage2.classList.remove('hidden');
          }, 300);
          return;
        }

        // è®¡ç®—éšæœºä½ç½®è®©æŒ‰é’®"èº²é¿"
        const container = stage1.getBoundingClientRect();
        const btnWidth = stage1No.offsetWidth;
        const btnHeight = stage1No.offsetHeight;

        const maxX = container.width - btnWidth - 20;
        const maxY = container.height - btnHeight - 20;

        // ç¡®ä¿æŒ‰é’®ä¸ä¼šè¶…å‡ºå®¹å™¨èŒƒå›´
        const randomX = Math.floor(Math.random() * maxX);
        const randomY = Math.floor(Math.random() * maxY);

        stage1No.style.position = 'relative';
        stage1No.style.left = `${randomX}px`;
        stage1No.style.top = `${randomY}px`;
      });

      // ç¬¬äºŒé˜¶æ®µï¼šå‘¨å›´éƒ½æ˜¯åŒæ„æŒ‰é’®
      document.querySelectorAll('.stage2-yes').forEach(btn => {
        btn.addEventListener('click', showEnvelope);
      });

      // ç¬¬äºŒé˜¶æ®µçš„"ä¸æ„¿æ„"æŒ‰é’®
      const stage2No = document.getElementById('stage2-no');
      stage2No.addEventListener('mouseover', () => {
        stage2Attempts++;

        if (stage2Attempts >= MAX_STAGE2_ATTEMPTS) {
          stage2.classList.add('opacity-0', 'scale-95');
          setTimeout(() => {
            stage2.classList.add('hidden');
            finalStage.classList.remove('hidden');
            // æ˜¾ç¤ºå¦ä¸€ç‰ˆå…¥å£
            anotherVersion.classList.add('visible');
          }, 300);
          return;
        }

        // è®©æŒ‰é’®åœ¨æ›´å¤§èŒƒå›´å†…ç§»åŠ¨
        const container = stage2.querySelector('.relative');
        const rect = container.getBoundingClientRect();
        const btnWidth = stage2No.offsetWidth;
        const btnHeight = stage2No.offsetHeight;

        const maxX = rect.width - btnWidth - 40;
        const maxY = rect.height - btnHeight - 40;

        const randomX = Math.floor(Math.random() * maxX) - (maxX / 2);
        const randomY = Math.floor(Math.random() * maxY) - (maxY / 2);

        stage2No.style.transform = `translate(${randomX}px, ${randomY}px)`;
      });

      // æœ€ç»ˆé˜¶æ®µæ‰€æœ‰æŒ‰é’®éƒ½æ˜¾ç¤ºä¿¡å°
      document.querySelectorAll('.final-btn').forEach(btn => {
        btn.addEventListener('click', showEnvelope);
      });

      // ä¿¡å°ç‚¹å‡»äº‹ä»¶
      envelopeWrapper.addEventListener('click', function() {
        this.classList.toggle('envelope-opened');

        // æ‰“å¼€åå»¶è¿Ÿæ˜¾ç¤ºè·³è½¬æç¤º
        if (this.classList.contains('envelope-opened')) {
          setTimeout(() => {
            envelopePopup.classList.add('hidden');
            redirectMessage.classList.remove('hidden');
          }, 2000);
        }
      });

      // è·³è½¬æŒ‰é’®
      redirectBtn.addEventListener('click', function() {
        window.location.href = targetUrl;
      });

      // å¦ä¸€ç‰ˆå…¥å£
      anotherVersion.addEventListener('click', function() {
        window.location.href = anotherVersionUrl;
      });
    }
  </script>
</body>
</html>